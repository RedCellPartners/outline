{
  "version": 3,
  "sources": ["../../framesync/dist/es/on-next-frame.js", "../../framesync/dist/es/create-render-step.js", "../../framesync/dist/es/index.js"],
  "sourcesContent": ["var defaultTimestep = (1 / 60) * 1000;\nvar getCurrentTime = typeof performance !== \"undefined\"\n    ? function () { return performance.now(); }\n    : function () { return Date.now(); };\nvar onNextFrame = typeof window !== \"undefined\"\n    ? function (callback) {\n        return window.requestAnimationFrame(callback);\n    }\n    : function (callback) {\n        return setTimeout(function () { return callback(getCurrentTime()); }, defaultTimestep);\n    };\n\nexport { defaultTimestep, onNextFrame };\n", "function createRenderStep(runNextFrame) {\n    var toRun = [];\n    var toRunNextFrame = [];\n    var numToRun = 0;\n    var isProcessing = false;\n    var toKeepAlive = new WeakSet();\n    var step = {\n        schedule: function (callback, keepAlive, immediate) {\n            if (keepAlive === void 0) { keepAlive = false; }\n            if (immediate === void 0) { immediate = false; }\n            var addToCurrentFrame = immediate && isProcessing;\n            var buffer = addToCurrentFrame ? toRun : toRunNextFrame;\n            if (keepAlive)\n                toKeepAlive.add(callback);\n            if (buffer.indexOf(callback) === -1) {\n                buffer.push(callback);\n                if (addToCurrentFrame && isProcessing)\n                    numToRun = toRun.length;\n            }\n            return callback;\n        },\n        cancel: function (callback) {\n            var index = toRunNextFrame.indexOf(callback);\n            if (index !== -1)\n                toRunNextFrame.splice(index, 1);\n            toKeepAlive.delete(callback);\n        },\n        process: function (frameData) {\n            var _a;\n            isProcessing = true;\n            _a = [toRunNextFrame, toRun], toRun = _a[0], toRunNextFrame = _a[1];\n            toRunNextFrame.length = 0;\n            numToRun = toRun.length;\n            if (numToRun) {\n                for (var i = 0; i < numToRun; i++) {\n                    var callback = toRun[i];\n                    callback(frameData);\n                    if (toKeepAlive.has(callback)) {\n                        step.schedule(callback);\n                        runNextFrame();\n                    }\n                }\n            }\n            isProcessing = false;\n        },\n    };\n    return step;\n}\n\nexport { createRenderStep };\n", "import { onNextFrame, defaultTimestep } from './on-next-frame.js';\nimport { createRenderStep } from './create-render-step.js';\n\nvar maxElapsed = 40;\nvar useDefaultElapsed = true;\nvar runNextFrame = false;\nvar isProcessing = false;\nvar frame = {\n    delta: 0,\n    timestamp: 0\n};\nvar stepsOrder = [\"read\", \"update\", \"preRender\", \"render\", \"postRender\"];\nvar steps = /*#__PURE__*/stepsOrder.reduce(function (acc, key) {\n    acc[key] = createRenderStep(function () {\n        return runNextFrame = true;\n    });\n    return acc;\n}, {});\nvar sync = /*#__PURE__*/stepsOrder.reduce(function (acc, key) {\n    var step = steps[key];\n    acc[key] = function (process, keepAlive, immediate) {\n        if (keepAlive === void 0) {\n            keepAlive = false;\n        }\n        if (immediate === void 0) {\n            immediate = false;\n        }\n        if (!runNextFrame) startLoop();\n        return step.schedule(process, keepAlive, immediate);\n    };\n    return acc;\n}, {});\nvar cancelSync = /*#__PURE__*/stepsOrder.reduce(function (acc, key) {\n    acc[key] = steps[key].cancel;\n    return acc;\n}, {});\nvar flushSync = /*#__PURE__*/stepsOrder.reduce(function (acc, key) {\n    acc[key] = function () {\n        return steps[key].process(frame);\n    };\n    return acc;\n}, {});\nvar processStep = function (stepId) {\n    return steps[stepId].process(frame);\n};\nvar processFrame = function (timestamp) {\n    runNextFrame = false;\n    frame.delta = useDefaultElapsed ? defaultTimestep : Math.max(Math.min(timestamp - frame.timestamp, maxElapsed), 1);\n    frame.timestamp = timestamp;\n    isProcessing = true;\n    stepsOrder.forEach(processStep);\n    isProcessing = false;\n    if (runNextFrame) {\n        useDefaultElapsed = false;\n        onNextFrame(processFrame);\n    }\n};\nvar startLoop = function () {\n    runNextFrame = true;\n    useDefaultElapsed = true;\n    if (!isProcessing) onNextFrame(processFrame);\n};\nvar getFrameData = function () {\n    return frame;\n};\n\nexport default sync;\nexport { cancelSync, flushSync, getFrameData };\n"],
  "mappings": "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",
  "names": ["runNextFrame", "isProcessing"]
}
